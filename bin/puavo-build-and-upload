#!/bin/sh

help(){
    echo "
    Usage: $(basename $0) <DEBBOX URL>

    Build and publish debian native package to given debbox url.

    https://github.com/opinsys/debbox
    "

}

[ "$1" = "--help" -o "$1" = "-h" ] && help && exit 0
[ "$1" = "" ] && help && exit 1

set -eu

debbox_url="$1"

set -eu

if [ ! -d debian ]; then
    echo "Cannot find debian directory from cwd ($(pwd)/debian)"
    exit 1
fi

# Convert package to debian native format.
sed -i s/quilt/source/ debian/source/format

dpkg-buildpackage -us -uc

for deb in ../*.deb; do
    echo "Uploading $deb"
    curl --form "deb=@package.deb" $debbox_url
done
